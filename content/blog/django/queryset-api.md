---
title: QuerySet API
date: 2020-11-06 18:11:58
category: Django
thumbnail: ../TIL/images/django.png
draft: false
---

![](../TIL/images/django.png)

# filter( )

```python
filter(**kwargs)
```

ì§€ì •ëœ ì¡°íšŒ ë§¤ê°œ ë³€ìˆ˜ì™€ ì¼ì¹˜í•˜ëŠ” ê°ì²´ë¥¼ í¬í•¨í•˜ëŠ” ìƒˆë¡œìš´ `QuerySet`ì„ ë°˜í™˜í•œë‹¤.

ì¡°íšŒ ë§¤ê°œ ë³€ìˆ˜ `(**kwargs)`ëŠ” í•„ë“œ ì¡°íšŒ í˜•ì‹ì´ì–´ì•¼ í•œë‹¤. ì—¬ëŸ¬ ë§¤ê°œ ë³€ìˆ˜ëŠ” ê¸°ë³¸ SQLë¬¸ì—ì„œ `AND`ë¥¼ í†µí•´ ê²°í•©ëœë‹¤.

ë” ë³µì¡í•œ ì¿¼ë¦¬ (ì˜ˆë¥¼ë“¤ì–´ `OR`ë¬¸ì´ ìˆëŠ” ì¿¼ë¦¬)ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš° `Q objects`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

# exclude( )

```python
exclude(**kwargs)
```

ì§€ì •ëœ ì¡°íšŒ ë§¤ê°œ ë³€ìˆ˜ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê°ì²´ë¥¼ í¬í•¨í•˜ëŠ” ìƒˆë¡œìš´ `QuerySet`ì„ ë°˜í™˜í•œë‹¤.

ì¡°íšŒ ë§¤ê°œ ë³€ìˆ˜ `(**kwargs)`ëŠ” í•„ë“œ ì¡°íšŒ í˜•ì‹ì´ì–´ì•¼ í•œë‹¤. ì—¬ëŸ¬ ë§¤ê°œ ë³€ìˆ˜ëŠ” ê¸°ë³¸ SQLë¬¸ì—ì„œ `AND`ë¥¼ í†µí•´ ê²°í•©ë˜ë©° ì „ì²´ê°€ `NOT()`ìœ¼ë¡œ ë¬¶ì—¬ ìˆë‹¤.

ì•„ë˜ ì˜ˆì œëŠ” `pub_date`ê°€ 2005-01-03ì´í›„ ì´ë©°(`AND`) ì œëª©ì´ 'Hello'ëª¨ë“  í•­ëª©ì„ ì œì™¸í•œë‹¤.

```python
Entry.objects.exclude(pub_date__gt=datetime.date(2005, 1, 3), headline='Hello')
```

SQLë¬¸ìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```sql
SELECT ...
WHERE NOT (pub_date > '2005-01-03' AND headline = 'Hello')
```

ì•„ë˜ ì˜ˆì œëŠ” `pub_date`ê°€ 2005-01-03ì´í›„ ì´ê³ (`OR`) ì œëª©ì´ 'Hello'ëª¨ë“  í•­ëª©ì„ ì œì™¸í•œë‹¤.

```python
Entry.objects.exclude(pub_date__gt=datetime.date(2005, 1, 3)).exclude(headline='Hello')
```

SQLë¬¸ìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```sql
SELECT ...
WHERE NOT pub_date > '2005-1-3'
AND NOT headline = 'Hello'
```

ë‘ë²ˆì§¸ ì˜ˆì œëŠ” ë” ì œí•œì ì´ë©° ë” ë³µì¡í•œ ì¿¼ë¦¬ (ì˜ˆë¥¼ë“¤ì–´ `OR`ë¬¸ì´ ìˆëŠ” ì¿¼ë¦¬)ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš° `Q objects`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

# annotate( )

```python
annotate(*args, **kwargs)
```

ì œê³µëœ ì¿¼ë¦¬ ì‹ ëª©ë¡ì„ ì‚¬ìš©í•˜ì—¬ `QuerySet`ì˜ ê° ê°ì²´ì— ì£¼ì„ì„ ì¶”ê°€í•œë‹¤. ì‹ì€ ë‹¨ìˆœ ê°’, ëª¨ë¸ì˜ í•„ë“œì— ëŒ€í•œ ì°¸ì¡° (ë˜ëŠ” ëª¨ë“  ê´€ê³„ ëª¨ë¸), ë˜ëŠ” ê°ì²´ì™€ ê´€ë ¨ëœ ê°ì²´ì— ëŒ€í•œ ê³„ì‚°ëœ ì§‘ê³„ ì‹ (í‰ê· , í•©ê³„ ë“±)ì¼ ìˆ˜ ìˆë‹¤.

`annotate()`ì˜ ê° ì¸ìˆ˜ëŠ” ë°˜í™˜ë˜ëŠ” `QuerySet`ì˜ ê° ê°ì²´ì— ì¶”ê°€ë˜ëŠ” ì£¼ì„ì´ë‹¤.

`**kwargs`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ì£¼ì„ì€ í‚¤ì›Œë“œ ì£¼ì„ì˜ ë³„ì¹­ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. ìµëª… ì¸ìˆ˜ì—ëŠ” ì§‘ê³„ í•¨ìˆ˜ì˜ ì´ë¦„ê³¼ ì§‘ê³„ë˜ëŠ” ëª¨ë¸ í•„ë“œì— ë”°ë¼ ìƒì„±ëœ ë³„ì¹­ì´ ìˆë‹¤. ë‹¨ì¼ í•„ë“œë¥¼ ì°¸ì¡°í•˜ëŠ” ì§‘ê³„ì‹ë§Œ ìµëª… ì¸ìˆ˜ê°€ ë  ìˆ˜ ìˆë‹¤. ê·¸ ë°–ì— ëª¨ë“  ê²ƒì€ í‚¤ì›Œë“œ ì¸ìˆ˜ì—¬ì•¼ í•œë‹¤.

ì˜ˆë¥¼ë“¤ì–´ ë¸”ë¡œê·¸ ëª©ë¡ì„ ì¡°ì‘í•˜ëŠ” ê²½ìš° ê° ë¸”ë¡œê·¸ì— ì‘ì„±ëœ í•­ëª© ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
>>> from django.db.models import Count
>>> q = Blog.objects.annotate(Count('entry'))
# ì²«ë²ˆì§¸ ë¸”ë¡œê·¸ ì´ë¦„
>>> q[0].name
'Blogasaurus'
# ì²«ë²ˆì§¸ ë¸”ë¡œê·¸ì˜ í•­ëª© ìˆ˜
>>> q[0].entry__count
42
```

Blog ëª¨ë¸ì€ ìì²´ì ìœ¼ë¡œ `entry__count`ì†ì„±ì„ ì •ì˜í•˜ì§€ ì•Šì§€ë§Œ `**kwargs`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§‘ê³„ í•¨ìˆ˜ë¥¼ ì§€ì •í•˜ë©´ ì£¼ì„ì˜ ì´ë¦„ì„ ì‚¬ìš©ìê°€ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©° ì œì–´ í•  ìˆ˜ ìˆë‹¤.

```python
>>> q = Blog.objects.annotate(number_of_entries=Count('entry'))
# ì œê³µëœ ì´ë¦„ number of entriesì„ ì‚¬ìš©í•˜ëŠ” ì²«ë²ˆì§¸ ë¸”ë¡œê·¸ì˜ í•­ëª© ìˆ˜
>>> q[0].number_of_entries
42
```

ì§‘ê³„ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ë‹¤ìŒ](https://yongineer.netlify.app/django/django-orm-:-aggregation/)ì„ ì°¸ê³ í•œë‹¤.

# order_by( )

```python
order_by(*fields)
```

ê¸°ë³¸ì ìœ¼ë¡œ `QuerySet`ì— ì˜í•´ ë°˜í™˜ëœ ê²°ê³¼ëŠ” ëª¨ë¸ì˜ `Meta`í´ë˜ìŠ¤ì— ìˆëŠ” `ordering`ì˜µì…˜ì— ì˜í•´ ì œê³µë˜ëŠ” `ordering tuple`ì— ë”°ë¼ ì •ë ¬ëœë‹¤. í•˜ì§€ë§Œ `order_by`ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ `QuerySet`ë³„ë¡œ ì´ë¥¼ ì¬ì •ì˜ í•  ìˆ˜ ìˆë‹¤.

```python
Entry.objects.filter(pub_date__year=2005).order_by('-pub_date', 'headline')
```

ìœ„ì˜ ê²°ê³¼ëŠ” `pub_date`ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•œ ë‹¤ìŒ ì œëª©ì˜ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ëœë‹¤. `pub_date`ì•ì˜ `-`ê¸°í˜¸ëŠ” ë‚´ë¦¼ì°¨ìˆœì„ ì˜ë¯¸í•œë‹¤. ë¬´ì‘ìœ„ë¡œ ì •ë ¬í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ `?`ë¥¼ ì‚¬ìš©í•œë‹¤.

```python
Entry.objects.order_by('?')
```

ì°¸ê³ ë¡œ `order_by('?')`ëŠ” ì„±ëŠ¥ì´ ë§¤ìš° ì•ˆì¢‹ìœ¼ë‹ˆ ì‚¬ìš©ì„ ìì œí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ë‹¤ë¥¸ ëª¨ë¸ì˜ í•„ë“œë³„ë¡œ ì •ë ¬í•˜ë ¤ë©´ ëª¨ë¸ ê´€ê³„ì—ì„œ ì¿¼ë¦¬í•  ë•Œì™€ ë™ì¼í•œ êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤. ì¦‰, í•„ë“œ ì´ë¦„, double underscore(`__`), ìƒˆ ëª¨ë¸ì˜ í•„ë“œ ì´ë¦„ë“±ì´ ê²°í•©í•˜ë ¤ëŠ” ëª¨ë¸ ìˆ˜ë§Œí¼ ê³„ì†ëœë‹¤. ì˜ˆë¥¼ë“¤ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```python
Entry.objects.order_by('blog__name', 'headline')
```

ë‹¤ë¥¸ ëª¨ë¸ê³¼ ê´€ë ¨ëœ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ë ¤ê³  í•˜ë©´ `Django`ëŠ” ê´€ë ¨ ëª¨ë¸ì˜ ê¸°ë³¸ ìˆœì„œë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ `Meta`í´ë˜ìŠ¤ì˜ `ordering`ì´ ì§€ì •ë˜ì§€ ì•Šì€ ê²½ìš° ê´€ë ¨ ëª¨ë¸ì˜ `Primary Key`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•œë‹¤. ì˜ˆë¥¼ë“¤ì–´, Blogëª¨ë¸ì—ëŠ” ê¸°ë³¸ìˆœì„œê°€ ì§€ì •ë˜ì–´ ìˆì§€ ì•Šê¸°ë•Œë¬¸ì—

```python
Entry.objects.order_by('blog')
```

ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
Entry.objects.order_by('blog__id')
```

ë§Œì•½ Blogëª¨ë¸ì— `ordering = ['name']`ì´ ì§€ì •ë˜ì–´ ìˆëŠ” ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
Entry.objects.order_by('blog__name')
```

ë˜í•œ í‘œí˜„ì‹ì—ì„œ `asc()` ë˜ëŠ” `desc()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¿¼ë¦¬ í‘œí˜„ì‹ë³„ë¡œ ì •ë ¬ í•  ìˆ˜ ë„ ìˆë‹¤.

```python
Entry.objects.order_by(Coalesce('summary', 'headline').desc())
Entry.objects.order_by(Coalesce('summary', 'headline').asc())
```

`asc()`ì™€ `desc()`ì—ì„œëŠ” `null`ê°’ì„ ì •ë ¬í•˜ëŠ” ë°©ë²•ì„ ì œì–´í•˜ëŠ” ì¸ìˆ˜ `nulls_first`ë° `nulls_last`ê°€ ìˆë‹¤.

> **ğŸ’¡M:M ë˜ëŠ” ì—­ì°¸ì¡°ê´€ê³„ì—ì„œì˜ `order_by()`**
> 
ê²°ê³¼ë¥¼ ì •ë ¬í•˜ê¸° ìœ„í•´ ë‹¤ì¤‘ ê°’ í•„ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
>
 >```python
 ># Model
 >class Event(Model):
 >   parent = models.ForeignKey(
 >       'self',
 >       on_delete=models.CASCADE,
 >       related_name='children',
 >   )
 >   date = models.DateField()
 >```
 >
 >```python
 >Event.objects.order_by('children__date')
 >```
>
ì—¬ê¸°ì—ì„œ ê° ì´ë²¤íŠ¸ì— ëŒ€í•´ ì ì¬ì ìœ¼ë¡œ ì—¬ëŸ¬ ì£¼ë¬¸ ë°ì´í„°ê°€ ìˆì„ ìˆ˜ ìˆë‹¤. **ì—¬ëŸ¬ í•˜ìœ„ í•­ëª©ì´ ìˆëŠ” ê° ì´ë²¤íŠ¸ëŠ” `order_by()`ê°€ ìƒì„±í•˜ëŠ” ìƒˆ `QuerySet`ì— ì—¬ëŸ¬ë²ˆ ë°˜í™˜ëœë‹¤.** ì¦‰, `QuerySet`ì—ì„œ `order_by()`ë¥¼ ì‚¬ìš©í•˜ë©´ ì²˜ìŒì— ì‘ì—…í–ˆë˜ ê²ƒ ë³´ë‹¤ ë” ë§ì€ í•­ëª©ì„ ë°˜í™˜ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ì•„ë§ˆë„ ì˜ˆìƒí•˜ì§€ë„ ì“¸ëª¨ìˆì§€ë„ ì•Šì€ ë°ì´í„°ê°€ ë  ê²ƒì´ë‹¤.
>
ë”°ë¼ì„œ ë‹¤ì¤‘ ê°’ í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì •ë ¬ í•  ë•ŒëŠ” ì£¼ì˜í•´ì•¼ í•œë‹¤. ì£¼ë¬¸í•˜ëŠ” ê° í•­ëª©ì— ëŒ€í•´ í•˜ë‚˜ì˜ ì£¼ë¬¸ ë°ì´í„°ë§Œ ìˆë‹¤ê³  í™•ì‹ í•  ìˆ˜ ìˆë‹¤ë©´ ì´ ë°©ë²•ì€ ë¬¸ì œë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ê²°ê³¼ê°€ ì˜ˆìƒ í•œ ê²°ê³¼ì¸ì§€ í™•ì¸í•´ì•¼ í•  í•„ìš”ê°€ ìˆë‹¤.

> **âš ï¸ `order_by()`ëŠ” ì¿¼ë¦¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.**
 >
 >`order_by()`ì— ì¶”ê°€ë˜ëŠ” ê° í•„ë“œëŠ” ì¿¼ë¦¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤. ì¶”ê°€í•˜ëŠ” ì™¸ë˜í‚¤ ì—­ì‹œ í¬í•¨ëœë‹¤.
 >
 >ì¿¼ë¦¬ì— ìˆœì„œê°€ ì§€ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§€ì •ë˜ì§€ ì•Šì€ ìˆœì„œë¡œ ê²°ê³¼ê°€ ë¦¬í„´ëœë‹¤. íŠ¹ì • ìˆœì„œë¡œ ì •ë ¬í• ë•ŒëŠ” ê²°ê³¼ì—ì„œ ê° ê°ì²´ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” í•„ë“œ ì§‘í•©ìœ¼ë¡œ `order_by()`í• ë•Œë§Œ ë³´ì¥ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì´ë¦„ í•„ë“œê°€ ê³ ìœ í•˜ì§€ ì•Šì€ ê²½ìš° ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•œë‹¤ê³  í•´ì„œ ì´ë¦„ì´ ê°™ì€ ê°ì²´ê°€ í•­ìƒ ê°™ì€ ìˆœì„œë¡œ í‘œì‹œë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.

# reverse( )

```python
reverse()
```

`reverse()`ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ `QuerySet`ì˜ ìš”ì†Œê°€ ë¦¬í„´í•˜ëŠ” ìˆœì„œë¥¼ ë°˜ëŒ€ë¡œ ë§Œë“¤ìˆ˜ ìˆë‹¤. `reverse()`ë¥¼ ë‘ë²ˆ í˜¸ì¶œí•œë‹¤ë©´ ë‹¤ì‹œ ì •ìƒ ë°©í–¥ìœ¼ë¡œ ë˜ëŒì•„ ì˜¨ë‹¤.

ì¿¼ë¦¬ì…‹ì—ì„œ ë§ˆì§€ë§‰ 5ê°œ í•­ëª©ì„ ê²€ìƒ‰í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```python
my_queryset.reverse()[:5]
```

ì´ê²ƒì€ `Python`ì—ì„œ ì‹œí€€ìŠ¤ ëì— ìŠ¬ë¼ì´ìŠ¤ í•˜ëŠ”ê²ƒê³¼ ì™„ì „íˆ ê°™ì§€ ì•Šë‹¤. ìœ„ì˜ ì˜ˆëŠ” ë§ˆì§€ë§‰ í•­ëª©ì„ ë¨¼ì € ë°˜í™˜í•œ ë‹¤ìŒ ë‘ë²ˆì§¸ë¡œ 5ê°œë¥¼ ë°˜í™˜í•˜ëŠ” ì ˆì°¨ë¥¼ ì§„í–‰í•œë‹¤. `Python`ì—ì„œëŠ” `seq[-5:]`ì™€ ê°™ì´ ì‹œí€€ìŠ¤ì˜ ìˆœì„œë¥¼ ë°˜ëŒ€ë¡œ ë’¤ì§‘ì§€ ì•Šì•„ë„ ë§ˆì§€ë§‰ 5ê°œì˜ í•­ëª©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì§€ë§Œ `Django`ì—ì„œëŠ” ì´ëŸ° ê³¼ì •ì„ SQLì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰ í•  ìˆ˜ ì—†ê¸°ë•Œë¬¸ì— ëì—ì„œ ìŠ¬ë¼ì´ìŠ¤ì™€ ê°™ì€ ì—‘ì„¸ìŠ¤ ëª¨ë“œë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

ë˜í•œ `reverse()`ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì •ì˜ ëœ ìˆœì„œê°€ ìˆëŠ” ì¿¼ë¦¬ì…‹ì—ì„œë§Œ í˜¸ì¶œë˜ì–´ì•¼ í•œë‹¤. (ê¸°ë³¸ ìˆœì„œë¥¼ ì •ì˜í•˜ëŠ” ëª¨ë¸ì— ëŒ€í•´ ì¿¼ë¦¬ í•  ë•Œ ë˜ëŠ” `order_by()`ë¥¼ ì‚¬ìš© í•  ë•Œ), ë§Œì•½ ì£¼ì–´ì§„ ì¿¼ë¦¬ì…‹ì— ëŒ€í•´ ì´ëŸ¬í•œ ìˆœì„œê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° `reverse()`ë¥¼ í˜¸ì¶œ í•´ë„ íš¨ê³¼ê°€ ì—†ë‹¤.

# distinct( )

```python
distinct()

# Only PostgreSQL
distinct(*fields)
```

SQLë¬¸ë²•ì—ì„œ `SELECT DISTINCT`ë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒˆë¡œìš´ QuerySetì„ ë¦¬í„´í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì¿¼ë¦¬ ê²°ê³¼ì—ì„œ ì¤‘ë³µ í–‰ì´ ì œê±°ëœë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ `QuerySet`ì€ ì¤‘ë³µí–‰ì„ ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤. ì‹¤ì œë¡œ `Bolg.objects.all()`ê³¼ ê°™ì€ ê°„ë‹¨í•œ ì¿¼ë¦¬ëŠ” ê²°ê³¼ í–‰ì´ ì¤‘ë³µ ë  ê°€ëŠ¥ì„±ì´ ì—†ê¸° ë•Œë¬¸ì— ì´ëŠ” ê±°ì˜ ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëŸ¬ë‚˜ ì¿¼ë¦¬ê°€ ì—¬ëŸ¬ í…Œì´ë¸”ì„ ê±¸ì³ì•¼ í•œë‹¤ë©´ ì¤‘ë³µë˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤ ì´ëŸ´ë•Œ `distinct()`ë¥¼ ì‚¬ìš©í•œë‹¤.

PostgreSQLì—ì„œëŠ” `distinct()`ì— Positional argumentsë¥¼ ì „ë‹¬ í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ ì¸ì ê°’ì€ í•„ë“œ ê°’ì´ë‹¤. ì´ê²ƒì€ `SELECT DISTINCT ON`ê³¼ ê°™ì€ SQLì¿¼ë¦¬ë¡œ ë³€í™˜ëœë‹¤ í•˜ì§€ë§Œ Raw SQLê³¼ ì°¨ì´ì ì´ ì¡´ì¬í•˜ëŠ”ë° ì¼ë°˜ì ì¸ `distinct()`í˜¸ì¶œì˜ ê²½ìš° ë°ì´í„° ë² ì´ìŠ¤ëŠ” êµ¬ë³„ë˜ëŠ” í–‰ì„ ê²°ì •í•  ë•Œ ê° í–‰ì˜ ê° í•„ë“œë¥¼ ë¹„êµí•œë‹¤. í•˜ì§€ë§Œ ORMì—ì„œëŠ” ì§€ì •ëœ í•„ë“œë¥¼ ì¸ìë¡œ ê°–ëŠ”  `distinct()`í˜¸ì¶œì˜ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ê°€ ì§€ì •ëœ í•„ë“œ ì´ë¦„ë§Œ ë¹„êµí•œë‹¤.

> **ğŸ’¡í•„ë“œë¥¼ ì¸ìˆ˜ë¡œ ê°–ëŠ” `distinct()`**
 >
 >í•„ë“œ ì´ë¦„ì„ ì§€ì •í•  ë•Œ QuerySetì—ëŠ” `order_by()`ê°€ í•„ìš”í•˜ë©° `order_by()`ì˜ í•„ë“œëŠ” `distinct()`ì— ì œê³µëœ í•„ë“œì™€ ë™ì¼í•˜ê²Œ ì§€ì •ë˜ì–´ì•¼ í•œë‹¤.
 >
 >ì˜ˆë¥¼ë“¤ì–´ `SELECT DISTINCT ON (a)`ëŠ” aì—´ì˜ ê° ê°’ì— ëŒ€í•œ ì²« ë²ˆì§¸ í–‰ì„ ì œê³µí•œë‹¤. ë§Œì•½ orderingì´ ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ì„ì˜ì˜ í–‰ì´ ë¦¬í„´ëœë‹¤.
 >
 >ì˜ˆì‹œ (PostgreSQLì—ì„œë§Œ ê°€ëŠ¥)
 >
 >```python
 >>>> Author.objects.distinct()
 >
 >>>> Entry.objects.order_by('pub_date').distinct('pub_date')
 >
 >>>> Entry.objects.order_by('blog').distinct('blog')
 >
 >>>> Entry.objects.order_by('author', 'pub_date').distinct('author', 'pub_date')
 >
 >>>> Entry.objects.order_by('blog__name', 'mod_date').distinct('blog__name', 'mod_date')
 >
 >>>> Entry.objects.order_by('author', 'pub_date').distinct('author')
 >```

> **âš ï¸ `order_by()`ì™€ `distinct()`**
 >
 >`order_by()`í˜¸ì¶œì— ì‚¬ìš©ëœ ëª¨ë“  í•„ë“œëŠ” SQL `SELECT`ì»¬ëŸ¼ì— í¬í•¨ëœë‹¤. ì´ë¡œ ì¸í•´ `distinct()`ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì˜ˆê¸°ì¹˜ ì•Šì€ ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ë§Œì•½ ì—°ê³„ëœ ëª¨ë¸ì˜ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ë©´ í•´ë‹¹ í•„ë“œê°€ ì„ íƒí•œ ì—´ì— ì¶”ê°€ë˜ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì¤‘ë³µëœ í–‰ì´ êµ¬ë³„ë˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆë‹¤. ì¶”ê°€ ì—´ì€ ë°˜í™˜ëœ ê²°ê³¼ì— í‘œì‹œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— (ìˆœì„œ ì§€ì •ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ë¦¬í„´ê°’ì— í‘œì‹œ) ë•Œë•Œë¡œ ëª…í™•í•˜ì§€ ì•Šì€ ê²°ê³¼ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.
 >
 >ë§ˆì°¬ê°€ì§€ë¡œ `values()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ íƒí•œ ì—´ì„ ì œí•œí•˜ëŠ” ê²½ìš° `order_by()`(ë˜ëŠ” ê¸°ë³¸ ordering)ì— ì‚¬ìš©ëœ ì—´ì´ ê³„ì† ê´€ë ¨ë˜ë©° ê²°ê³¼ì˜ ê³ ìœ ì„±ì— ì˜í–¥ì„ ë¯¸ì¹ ìˆ˜ ìˆë‹¤.
 >
 >ì—¬ê¸°ì„œ ì¤‘ìš”í•œê²ƒì€ **ì—¬ëŸ¬ ëª¨ë¸ì´ ì—°ê´€ë˜ì–´ ìˆëŠ” ì¿¼ë¦¬ì…‹ì—  `distinct()`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì •ë ¬ ê¸°ì¤€ì´ ê´€ë ¨ ëª¨ë¸ì˜ í•„ë“œë¼ë©´ ì£¼ì˜**í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ, `**distinct()`ë° `values()`ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ë•ŒëŠ” `values()`ì˜ í•„ë“œê°€ ì•„ë‹Œ ì´ì™¸ì˜ í•„ë“œë¡œ ì •ë ¬ í•  ë•Œ ì£¼ì˜**í•´ì•¼ í•œë‹¤.
 >
 >ë˜í•œ `order_by()`ëŠ” ì •ì˜ëœ ê¸°ë³¸ ê´€ë ¨ ëª¨ë¸ ìˆœì„œë¥¼ ì‚¬ìš©í•œë‹¤. `DISTINCT ON`ì‹ì´ `ORDER BY`ì ˆì˜ ì‹œì‘ ë¶€ë¶„ì— ìˆëŠ” ì‹ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ê´€ê³„ì˜ `_id`ë˜ëŠ” ì°¸ì¡°ëœ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª…ì‹œì ìœ¼ë¡œ ì •ë ¬í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Blogëª¨ë¸ì´ ì´ë¦„ìœ¼ë¡œ ì •ë ¬ì„ ì •ë ¬í•œ ê²½ìš°
 >
 >```python
 >Entry.objects.order_by('blog').distinct('blog')
 >```
 >
 >ìœ„ ì˜ˆì‹œëŠ” ì¿¼ë¦¬ê°€ `blog__name`ìœ¼ë¡œ ì •ë ¬ë˜ì–´ `DISTINCT ON`í‘œí˜„ì‹ê³¼ ì¼ì¹˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‘ í‘œí˜„ì‹ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ê´€ê³„ `_id`í•„ë“œ (ì´ ê²½ìš° `blog_id`)ë˜ëŠ” ì°¸ì¡° ëœ í•„ë“œ (`blog_pk`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëª…ì‹œì ìœ¼ë¡œ ì •ë ¬í•´ì•¼ í•œë‹¤.

# values( )

```python
values(*field, **expressions)
```

iterableë¡œ ì‚¬ìš©ë  ë•Œ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ë‹Œ `dictionary`ì„ ë°˜í™˜í•˜ëŠ” `QuerySet`ì„ ë°˜í™˜í•œë‹¤.

ê° `dirctionary`ëŠ” ëª¨ë¸ ê°ì²´ì˜ ì†ì„± ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” í‚¤ê°€ ìˆëŠ” ê°ì²´ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ë‹¤ìŒì˜ ì˜ˆì œëŠ” `values()`ê°€ ë°˜í™˜í•˜ëŠ” `dictionary`ì™€ ì¼ë°˜ ëª¨ë¸ ê°ì²´ë¥¼ ë¹„êµí•œë‹¤.

```python
# ì´ ëª©ë¡ì—ëŠ” Blog ê°ì²´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
>>> Blog.objects.filter(name__startswith='Beatles')
<QuerySet [<Blog: Beatles Blog>]>

# ì´ ëª©ë¡ì—ëŠ” dictionaryê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
>>> Blog.objects.filter(name__startswith='Beatles').values()
<QuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]>
```

`values()` ë©”ì„œë“œëŠ” `SELECT`ê°€ ì œí•œë˜ì–´ì•¼ í•˜ëŠ” í•„ë“œ ì´ë¦„ì„ ì§€ì •í•˜ëŠ” optional positional arguments ì¸ `*fields`ë¥¼ ì‚¬ìš©í•œë‹¤. í•„ë“œë¥¼ ì§€ì •í•˜ë©´ ê° `dictionary`ì—ëŠ” ì§€ì •í•œ í•„ë“œì— ëŒ€í•œ keyì™€ ëŒ€ì‘í•˜ëŠ” valueë§Œ í¬í•¨ëœë‹¤. í•„ë“œë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ `dictionary`ì— ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ëª¨ë“  í•„ë“œì— ëŒ€í•œ keyì™€ valueê°€ í¬í•¨ëœë‹¤.

```python
>>> Blog.objects.values()
<QuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]>
>>> Blog.objects.values('id', 'name')
<QuerySet [{'id': 1, 'name': 'Beatles Blog'}]>
```

`values()`ë©”ì„œë“œëŠ” `annotate()`ë¡œ ì „ë‹¬ë˜ëŠ” optional keyword argumentsì¸ `**expresstions`ì„ ì‚¬ìš©í•œë‹¤.

```python
>>> from django.db.models.functions import Lower
>>> Blog.objects.values(lower_name=Lower('name'))
<QuerySet [{'lower_name': 'beatles blog'}]>
```

`values()`ë©”ì„œë“œëŠ” ì •ë ¬ëœ ì‚¬ìš©ì ì§€ì •ì¡°íšŒë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```python
>>> from django.db.models import CharField
>>> from django.db.models.functions import Lower
>>> CharField.register_lookup(Lower)
>>> Blog.objects.values('name__lower')
<QuerySet [{'name__lower': 'beatles blog'}]>
```

`values()`ì ˆ ë‚´ì˜ ì§‘ê³„ëŠ” ë™ì¼í•œ `values()`ì ˆ ë‚´ì˜ ë‹¤ë¥¸ ì¸ìˆ˜ ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤. ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ê·¸ë£¹í™” í•´ì•¼í•˜ëŠ” ê²½ìš° `value()`ì ˆê³¼ ë¶„ë¦¬í•˜ì—¬ ì§‘ê³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```python
>>> from django.db.models import Count
>>> Blog.objects.values('entry__authors', entries=Count('entry'))
<QuerySet [{'entry__authors': 1, 'entries': 20}, {'entry__authors': 1, 'entries': 13}]>
>>> Blog.objects.values('entry__authors').annotate(entries=Count('entry'))
<QuerySet [{'entry__authors': 1, 'entries': 33}]>
```

ì‚¬ìš© ê°€ëŠ¥í•œ ì¼ë¶€ í•„ë“œì˜ ê°’ë§Œ í•„ìš”í•˜ê³  ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ì˜ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ì•Œê³ ìˆì„ë•Œ ìœ ìš©í•˜ë‹¤. ì‚¬ìš©í•´ì•¼ í•˜ëŠ” í•„ë“œë§Œ ì„ íƒí•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ `values()`í˜¸ì¶œ í›„ì— `filter()`, `order_by()`ë“±ì„ í˜¸ì¶œ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ì´ ë‘ í˜¸ì¶œì´ ë™ì¼í•˜ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

```python
Blog.objects.values().order_by('id')
Blog.objects.order_by('id').values()
```

`OneToOneField`, `ForeignKey`ë° `ManyToManyField`ì†ì„±ì„ í†µí•´ ì—­ì°¸ì¡°ê°€ ìˆëŠ” ê´€ë ¨ ëª¨ë¸ì˜ í•„ë“œë¥¼ ì°¸ì¡° í•  ìˆ˜ë„ ìˆë‹¤.

```python
>>> Blog.objects.values('name', 'entry__headline')
<QuerySet [{'name': 'My blog', 'entry__headline': 'An entry'},
     {'name': 'My blog', 'entry__headline': 'Another entry'}, ...]>
```

> **âš ï¸ `ManyToManyField`ì—ì„œ `values()`ì‚¬ìš©ì‹œ ì£¼ì˜ ì‚¬í•­**
>
`ManyToManyField`ì†ì„± ë° ì—­ì°¸ì¡° ê´€ê³„ì—ëŠ” ì—¬ëŸ¬ í–‰ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ í¬í•¨í•˜ì—¬ ê²°ê³¼ ì§‘í•©ì˜ ë¦¬í„´ê°’ì´ ë°°ë¡œ ëŠ˜ì–´ë‚˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. ì´ëŠ” `values()`ì¿¼ë¦¬ì— ì´ëŸ¬í•œ í•„ë“œë¥¼ ì—¬ëŸ¬ ê°œ í¬í•¨í•˜ëŠ” ê²½ìš° íŠ¹íˆ ìì£¼ ë°œìƒí•˜ë©°, ì´ ê²½ìš° ê°€ëŠ¥í•œ ëª¨ë“  ì¡°í•©ì´ ë°˜í™˜ëœë‹¤. 

### ëª‡ê°€ì§€ ìœ ì˜ ì‚¬í•­

- ë§Œì•½ ì™¸ë˜í‚¤ì¸ `foo`ë¼ëŠ” í•„ë“œê°€ ìˆëŠ” ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ `values()`í˜¸ì¶œì€ ì‹¤ì œ ê°’ì„ ì €ì¥í•˜ëŠ” ìˆ¨ê²¨ì§„ ëª¨ë¸ ì†ì„±ì˜ ì´ë¦„ì´ê¸° ë•Œë¬¸ì— `foo_id`ë¼ëŠ” `dictionary` keyë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤. (`foo` ì†ì„±ì€ ì—°ê´€ ëª¨ë¸ì„ ë‚˜íƒ€ë‚¸ë‹¤) `values()`ë¥¼ í˜¸ì¶œí•˜ê³  í•„ë“œ ì´ë¦„ì„ ì „ë‹¬í•  ë•Œ `foo` ë˜ëŠ” `foo_id`ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìœ¼ë©° ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. (`dictionary`keyëŠ” ì „ë‹¬í•œ í•„ë“œ ì´ë¦„ê³¼ ì¼ì¹˜í•œë‹¤.)

    ```python
    >>> Entry.objects.values()
    <QuerySet [{'blog_id': 1, 'headline': 'First Entry', ...}, ...]>

    >>> Entry.objects.values('blog')
    <QuerySet [{'blog': 1}, ...]>

    >>> Entry.objects.values('blog_id')
    <QuerySet [{'blog_id': 1}, ...]>
    ```

- `distinct()`ì™€ í•¨ê»˜ `values()`ë¥¼ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìˆœì„œê°€ ê²°ê³¼ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.
- `extra()`í˜¸ì¶œ í›„ì— `values()`ì ˆì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° `extra()`ì—ì„œ ì„ íƒì¸ìë¡œ ì •ì˜ëœ ëª¨ë“  í•„ë“œê°€ `values()`í˜¸ì¶œì— ëª…ì‹œì ìœ¼ë¡œ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤. `values()`í˜¸ì¶œ ì´í›„ì— ìˆ˜í–‰ëœ `extra()`í˜¸ì¶œì€ ì¶”ê°€ë¡œ ì„ íƒëœ í•„ë“œê°€ ë¬´ì‹œëœë‹¤.
- `values()`ë’¤ì— `only()`ë° `defer()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ì˜ë¯¸ê°€ ì—†ìœ¼ë¯€ë¡œ `TypeError`ê°€ ë°œìƒí•œë‹¤.
- ë³€í™˜ê³¼ ì§‘ê³„ë¥¼ ê²°í•©í•˜ë ¤ë©´ ëª…ì‹œì ìœ¼ë¡œ ë˜ëŠ” `values()`ì— ëŒ€í•œ í‚¤ì›Œë“œ ì¸ìˆ˜ë¡œ ë‘ ê°œì˜ `annotate()`í˜¸ì¶œì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ìœ„ì™€ ê°™ì´ í•´ë‹¹ í•„ë“œ ìœ í˜•ì— ë³€í™˜ì´ ë“±ë¡ëœ ê²½ìš° ì²«ë²ˆì§¸ `annotate(0`ë¥¼ ìƒëµ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒ ì˜ˆì œëŠ” ë™ì¼í•œ ê²°ê³¼ë¥¼ ê°–ëŠ”ë‹¤.

    ```python
    >>> from django.db.models import CharField, Count
    >>> from django.db.models.functions import Lower
    >>> CharField.register_lookup(Lower)
    >>> Blog.objects.values('entry__authors__name__lower').annotate(entries=Count('entry'))
    <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]>
    >>> Blog.objects.values(
    ...     entry__authors__name__lower=Lower('entry__authors__name')
    ... ).annotate(entries=Count('entry'))
    <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]>
    >>> Blog.objects.annotate(
    ...     entry__authors__name__lower=Lower('entry__authors__name')
    ... ).values('entry__authors__name__lower').annotate(entries=Count('entry'))
    <QuerySet [{'entry__authors__name__lower': 'test author', 'entries': 33}]>
    ```

# values_list( )

```python
values_list(*fields, flat=False, named=False)
```

ë°˜í™˜ ê°’ì´ `values()`ì™€ ë‹¤ë¥´ê²Œ íŠœí”Œì„ ë°˜í™˜í•œë‹¤ëŠ” ì ì„ ì œì™¸í•˜ë©´ `values()`ì™€ ìœ ì‚¬í•˜ë‹¤. ê° íŠœí”Œì—ëŠ” `values_list()`í˜¸ì¶œì— ì „ë‹¬ëœ ê° í•„ë“œ ë˜ëŠ” í‘œí˜„ì‹ì˜ ê°’ì´ í¬í•¨ëœë‹¤. ë”°ë¼ì„œ ì²«ë²ˆì§¸ í•­ëª©ì€ ì²«ë²ˆì§¸ í•„ë“œì´ë‹¤. ì˜ˆë¥¼ë“¤ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
>>> Entry.objects.values_list('id', 'headline')
<QuerySet [(1, 'First entry'), ...]>
>>> from django.db.models.functions import Lower
>>> Entry.objects.values_list('id', Lower('headline'))
<QuerySet [(1, 'first entry'), ...]>
```

ë‹¨ì¼ í•„ë“œë§Œ ì „ë‹¬í•˜ëŠ” ê²½ìš° `flat`ë§¤ê°œ ë³€ìˆ˜ë„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤. `True`ë©´ ë¦¬í„´ëœ ê²°ê³¼ê°€ ë‹¨ì¼ íŠœí”Œì´ ì•„ë‹ˆë¼ ë‹¨ì¼ ê°’ì„ì„ ì˜ë¯¸í•œë‹¤.

```python
>>> Entry.objects.values_list('id').order_by('id')
<QuerySet[(1,), (2,), (3,), ...]>

>>> Entry.objects.values_list('id', flat=True).order_by('id')
<QuerySet [1, 2, 3, ...]>
```

ë‹¨, í•„ë“œê°€ ë‘ê°œ ì´ìƒì¸ ê²½ìš° `flat`ì€ ì—ëŸ¬ë¥¼ ë°œìƒ ì‹œí‚¨ë‹¤.

`named = True`ë¥¼ ì „ë‹¬í•˜ì—¬ `namedtuple()`ì„ ê²°ê³¼ë¡œ ì–»ì„ ìˆ˜ ìˆë‹¤.

```python
>>> Entry.objects.values_list('id', 'headline', named=True)
<QuerySet [Row(id=1, headline='First entry'), ...]>
```

`namedtuple()`ì„ ì´ìš©í•˜ë©´ ê²°ê³¼ë¥¼ ë” ì½ê¸° ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ `namedtuple()`í˜•ìœ¼ë¡œ ë³€í™˜ë˜ë©´ì„œ ì•½ê°„ì˜ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒëœë‹¤.

`values_list()`ì— ê°’ì„ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©´ ì„ ì–¸ëœ ìˆœì„œëŒ€ë¡œ ëª¨ë¸ì˜ ëª¨ë“  í•„ë“œê°€ ë°˜í™˜ëœë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ `values_list()`ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì€ íŠ¹ì • ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ì˜ íŠ¹ì • í•„ë“œì˜ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œ ì‚¬ìš©í•œë‹¤. ì´ë¥¼ ìœ„í•´ `values_list()`ë‹¤ìŒ `get()`ì„ í˜¸ì¶œí•œë‹¤.

```python
>>> Entry.objects.values_list('headline', flat=True).get(pk=1)
'First entry'
```

`values()`ë° `values_list()`ëŠ” ëª¨ë‘ íŠ¹ì • ì‚¬ìš© ì‚¬ë¡€ì— ëŒ€í•œ ìµœì í™”ë¥¼ ìœ„í•œ ê²ƒì´ë‹¤. ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ì˜¤ë²„í—¤ë“œ ì—†ì´ ë°ì´í„° í•˜ìœ„ ì§‘í•©ì„ ê²€ìƒ‰í•œë‹¤. ë”°ë¼ì„œ **M:M ë° ê¸°íƒ€ ë‹¤ì¤‘ ê´€ê³„ (ì˜ˆ : 1:Mê´€ê³„ì—ì„œ ì—­ì°¸ì¡°)ë¥¼ ë‹¤ë£° ë•Œ "í•˜ë‚˜ì˜ í–‰, í•˜ë‚˜ì˜ ê°ì²´"ê°€ ì ìš©ë˜ì§€ ì•Šê³  ëª¨ë‘ ë¶„ë¦¬ ëœë‹¤.**

ë‹¤ìŒì€ `ManyToManyField`ë¥¼ ì¿¼ë¦¬ í•  ë•Œì˜ ë™ì‘ì´ë‹¤.

```python
>>> Author.objects.values_list('name', 'entry__headline')

<QuerySet [('Noam Chomsky', 'Impressions of Gaza'),
 ('George Orwell', 'Why Socialists Do Not Believe in Fun'),
 ('George Orwell', 'In Defence of English Cooking'),
 ('Don Quixote', None)]>
```

ë‹¤ìˆ˜ì˜ ì±…ì„ ì‘ì„±í•œ ì‘ì„±ìëŠ” ì—¬ëŸ¬ë²ˆ í‘œì‹œë˜ê³  í•­ëª©ì´ ì—†ëŠ” ì‘ì„±ìëŠ” `entry__headline`ì´ `None`ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ ì—­ì°¸ì¡°ë¥¼ ì¿¼ë¦¬í•  ë•Œ ì‘ì„±ìê°€ ì—†ëŠ” í•­ëª©ì— ëŒ€í•´ `None`ìœ¼ë¡œ í‘œì‹œëœë‹¤.

```python
>>> Entry.objects.values_list('authors')

<QuerySet [('Noam Chomsky',), ('George Orwell',), (None,)]>
```

# date( )

```python
date(field, kind, order='ASC')
```

`QuerySet`ì˜ ë‚´ìš© ë‚´ì—ì„œ íŠ¹ì • ì¢…ë¥˜ì˜ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ë‚ ì§œë¥¼ ë‚˜íƒ€ë‚´ëŠ” `datetime.date` ê°ì²´ ëª©ë¡ìœ¼ë¡œ í‰ê°€ë˜ëŠ” `QuerySet`ì„ ë¦¬í„´í•œë‹¤.

í•„ë“œëŠ” ëª¨ë¸ì˜ `DateField`ì–´ì•¼ í•œë‹¤. `kind`ëŠ” `year`, `month`, `week`, `day`ì–´ì•¼ í•œë‹¤. ê²°ê³¼ ëª©ë¡ì˜ ê° `datetime.date` ê°ì²´ëŠ” ì£¼ì–´ì§„ ìœ í˜•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì˜ë¼ë‚¸ë‹¤.

- `year`ëŠ” í•„ë“œì— ëŒ€í•œ ëª¨ë“  ê³ ìœ  ì—°ë„ ê°’ì´ ë‹´ê¸´ listë¥¼ ë°˜í™˜í•œë‹¤.
- `month`ëŠ” í•„ë“œì— ëŒ€í•œ ê³ ìœ í•œ ì—°ë„/ì›” ê°’ì´ ë‹´ê¸´ listë¥¼ ë°˜í™˜í•œë‹¤.
- `week`ëŠ” í•„ë“œì— ëŒ€í•œ ëª¨ë“  ê³ ìœ í•œ ì—°ë„/ì£¼ ê°’ì´ ë‹´ê¸´ listë¥¼ ë°˜í™˜í•˜ë©° ëª¨ë“  ë‚ ì§œëŠ” ì›”ìš”ì¼ì´ë‹¤.
- `day`ëŠ” í•„ë“œì— ëŒ€í•œ ëª¨ë“  ê³ ìœ í•œ ì—°/ì›”/ì¼ ê°’ì´ ë‹´ê¸´ listë¥¼ ë°˜í™˜í•œë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì •ë ¬ë˜ëŠ” ìˆœì„œëŠ” `ASC`(ì˜¤ë¦„ì°¨ìˆœ)ì´ë©° `order`ë¥¼ ì§€ì •í•  ë•ŒëŠ” `ASC`ë˜ëŠ” `DESC`ì—¬ì•¼ í•œë‹¤.

```python
>>> Entry.objects.dates('pub_date', 'year')
[datetime.date(2005, 1, 1)]
>>> Entry.objects.dates('pub_date', 'month')
[datetime.date(2005, 2, 1), datetime.date(2005, 3, 1)]
>>> Entry.objects.dates('pub_date', 'week')
[datetime.date(2005, 2, 14), datetime.date(2005, 3, 14)]
>>> Entry.objects.dates('pub_date', 'day')
[datetime.date(2005, 2, 20), datetime.date(2005, 3, 20)]
>>> Entry.objects.dates('pub_date', 'day', order='DESC')
[datetime.date(2005, 3, 20), datetime.date(2005, 2, 20)]
>>> Entry.objects.filter(headline__contains='Lennon').dates('pub_date', 'day')
[datetime.date(2005, 3, 20)]
```

# datetimes( )

```python
datetimes(field_name, kind, order='ASC', tzinfo=None, is_dst=None)
```

`QuerySet`ì˜ ë‚´ìš© ë‚´ì—ì„œ íŠ¹ì • ì¢…ë¥˜ì˜ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ë‚ ì§œë¥¼ ë‚˜íƒ€ë‚´ëŠ” `datetime.datetime` ê°ì²´ ëª©ë¡ìœ¼ë¡œ í‰ê°€ë˜ëŠ” `QuerySet`ì„ ë¦¬í„´í•œë‹¤.

`field_name`ì€ ëª¨ë¸ì˜ `DateTimeField`ì—¬ì•¼ í•œë‹¤. `kind`ëŠ” `year`, `month`, `week`, `day`, `hour`, `minute`, `second`ì–´ì•¼ í•œë‹¤. ê²°ê³¼ ëª©ë¡ì˜ ê° `datetime.datetime` ê°ì²´ëŠ” ì£¼ì–´ì§„ ìœ í˜•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì˜ë¼ë‚¸ë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì •ë ¬ë˜ëŠ” ìˆœì„œëŠ” `ASC`(ì˜¤ë¦„ì°¨ìˆœ)ì´ë©° `order`ë¥¼ ì§€ì •í•  ë•ŒëŠ” `ASC`ë˜ëŠ” `DESC`ì—¬ì•¼ í•œë‹¤.

`tzinfo`ëŠ” ìë¥´ê¸° ì „ì— `datetime`ì´ ë³€í™˜ë˜ëŠ” ì‹œê°„ëŒ€ë¥¼ ì •ì˜í•œë‹¤. ì‹¤ì œë¡œ ì£¼ì–´ì§„ `datetime`ì€ ì‚¬ìš©ì¤‘ì¸ ì‹œê°„ëŒ€ì— ë”°ë¼ ë‹¤ë¥¸ í‘œí˜„ì„ ê°–ëŠ”ë‹¤. ì´ ë§¤ê°œ ë³€ìˆ˜ëŠ” `datetime.tzinfo`ê°ì²´ì—¬ì•¼ í•œë‹¤. `None`ì´ë©´ Djangoì˜ í˜„ì¬ ì‹œê°„ëŒ€ë¥¼ ì‚¬ìš©í•œë‹¤. `USE_TZ`ê°€ `False`ë©´ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ë‹¤.

`is_dst`ëŠ” `pytz`ê°€ ì„œë¨¸íƒ€ì„ì„ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•œ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ (`is_dst = None`) `pyzt`ëŠ” ì´ëŸ¬í•œ ë‚ ì§œ ì‹œê°„ì— ëŒ€í•´ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

 > **ğŸ’¡ë°ì´í„°ë² ì´ìŠ¤ì˜ ì‹œê°„ëŒ€ë¥¼ ì‚¬ìš©í•˜ëŠ” `datetime()`**
 >
 >`datetime()`ì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ì‹œê°„ëŒ€ ë³€í™˜ì„ ìˆ˜í–‰í•œë‹¤. ë”°ë¼ì„œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” `tzinfo.tzname (None)`ì˜ ê°’ì„ í•´ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•œë‹¤.
 >
 >- SQLite : ìš”êµ¬ ì‚¬í•­ì´ ì—†ë‹¤. ë³€í™˜ì€ `Python`ì—ì„œ `pytz`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰ë˜ë©° ì´ íŒ¨í‚¤ì§€ëŠ” Djangoë¥¼ ì„¤ì¹˜í• ë•Œ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” íŒ¨í‚¤ì§€ì´ë‹¤.
 >- PostgreSQL : ìš”êµ¬ì‚¬í•­ ì—†ìŒ ([ì°¸ì¡°](https://www.postgresql.org/docs/current/datatype-datetime.html#DATATYPE-TIMEZONES))
 >- Oracle : ìš”êµ¬ì‚¬í•­ ì—†ìŒ ([ì°¸ì¡°](https://docs.oracle.com/en/database/oracle/oracle-database/18/nlspg/datetime-data-types-and-time-zone-support.html#GUID-805AB986-DE12-4FEA-AF56-5AABCD2132DF))
 >- MySQL : `mysql_tzinfo_to_sql`ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ëŒ€ í…Œì´ë¸”ì„ ê°€ì ¸ì˜¨ë‹¤. ([ì°¸ê³ ](https://dev.mysql.com/doc/refman/8.0/en/mysql-tzinfo-to-sql.html))

# none( )

```python
none()
```

`none()`ì„ í˜¸ì¶œí•˜ë©´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ì¿¼ë¦¬ì…‹ì´ ìƒì„±ë˜ê³  ê²°ê³¼ì— ì—‘ì„¸ìŠ¤ í•  ë•Œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. `qs.none()`ì¿¼ë¦¬ì…‹ì€ `EmptyQuerySet`ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ëœë‹¤.

```python
>>> Entry.objects.none()
<QuerySet []>
>>> from django.db.models.query import EmptyQuerySet
>>> isinstance(Entry.objects.none(), EmptyQuerySet)
True
```

# all( )

```python
all()
```

í˜„ì¬ `QuerySet` (ë˜ëŠ” `QuerySet` í•˜ìœ„ í´ë˜ìŠ¤)ì˜ ë³µì‚¬ë³¸ì„ ë°˜í™˜í•œë‹¤. ì´ëŠ” ëª¨ë¸ ê´€ë¦¬ì ë˜ëŠ” `QuerySet`ì— ì „ë‹¬í•˜ê³  ê²°ê³¼ì— ëŒ€í•œ ì¶”ê°€ í•„í„°ë§ì„ ìˆ˜í–‰í•˜ë ¤ëŠ” ìƒí™©ì—ì„œ ìœ ìš©í•  ìˆ˜ ìˆë‹¤. ë‘ ê°ì²´ ëª¨ë‘ `all()`ì„ í˜¸ì¶œ í•˜ë©´ ì‘ì—…í•  `QuerySet`ì„ í™•ì‹¤í•˜ê²Œ ê°–ê²Œëœë‹¤.

`QuerySet`ì´ í‰ê°€ ë  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ ê²°ê³¼ë¥¼ ìºì‹œí•œë‹¤. `QuerySet`ì´ í‰ê°€ ëœ ì´í›„ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ê°€ ë³€ê²½ëœ ê²½ìš° ì´ì „ì— í‰ê°€ëœ `QuerySet`ì—ì„œ `all()`ì„ í˜¸ì¶œí•˜ì—¬ ë™ì¼í•œ ì¿¼ë¦¬ì— ëŒ€í•œ ì—…ë°ì´íŠ¸ ëœ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

# union( )

```python
union(*other_qs, all=False)
```

SQLì˜ `UNION`ì„ ì‚¬ìš©í•˜ì—¬ ë‘˜ ì´ìƒì˜ `QuerySet` ê²°ê³¼ë¥¼ ê²°í•©í•œë‹¤.

```python
>>> qs1.union(qs2, qs3)
```

UNION ì—°ì‚°ìëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ê³ ìœ í•œ ê°’ë§Œ ì„ íƒí•œë‹¤. (`distinct()`ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ìˆ˜í–‰ë¨.) ì´ ë•Œ ì¤‘ë³µ ê°’ì„ í—ˆìš©í•˜ë ¤ë©´ `all = True`ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.

`union()`, `intersection()`, `difference()`ëŠ” ì¸ìˆ˜ê°€ ë‹¤ë¥¸ ëª¨ë¸ì˜ `QuerySet`ì¸ ê²½ìš°ì—ë„ ì²«ë²ˆì§¸ `QuerySet`ìœ í˜•ì˜ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. `SELECT` ëª©ë¡ì´ ëª¨ë“  `QuerySet`ì—ì„œ ë™ì¼í•˜ë©´ ë‹¤ë¥¸ ëª¨ë¸ì„ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ì‘ë™í•œë‹¤. (ìµœì†Œí•œ ìœ í˜•, ìœ í˜•ì´ ë™ì¼í•œ ìˆœì„œë©´ ì´ë¦„ì´ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.) ì´ëŸ¬í•œ ê²½ìš° `QuerySet`ì— ì ìš©ëœ `QuerySet`ë©”ì„œë“œì˜ ì²«ë²ˆì§¸ `QuerySet`ì˜ ì—´ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```python
>>> qs1 = Author.objects.values_list('name')
>>> qs2 = Entry.objects.values_list('headline')
>>> qs1.union(qs2).order_by('name')
```

ë˜í•œ ê²°ê³¼ QuerySetì—ëŠ” `LIMIT`, `OFFSET`, `COUNT(*)`, `ORDER BY`ë° ì—´ ì§€ì • (ìŠ¬ë¼ì´ì‹±, `count()`, `order_by()`, `value()`, `values_list()`)ë§Œ í—ˆìš©ëœë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê²°í•© ëœ ì¿¼ë¦¬ì—ì„œ í—ˆìš©ë˜ëŠ” ì‘ì—…ì— ì œí•œì„ ë‘”ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê²°í•© ëœ ì¿¼ë¦¬ì—ì„œ `LIMIT`ë˜ëŠ” `OFFSET`ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

# intersection( )

```python
intersection(*other_qs)
```

SQLì˜ `INTERSECT`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘˜ ì´ìƒì˜ `QuerySet`ì˜ êµì§‘í•©ì„ ë°˜í™˜í•œë‹¤.

```python
>>> qs1.intersection(qs2, qs3)
```

`intersection()`ì˜ ì œí•œì‚¬í•­ì€ `union()`ê³¼ ë™ì¼í•˜ë‹¤.

# difference( )

```python
difference(*other_qs)
```

SQLì˜ `EXCEPT`ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘˜ ì´ìƒì˜ `QuerySet`ì˜ ì°¨ì§‘í•©ì„ ë°˜í™˜í•œë‹¤.

```python
>>> qs1.difference(qs2, qs3)
```

`difference()`ì˜ ì œí•œì‚¬í•­ì€ `union()`ê³¼ ë™ì¼í•˜ë‹¤.

# extra( )

```python
extra(select=None, where=None, params=None, tables=None, order_by=None, select_params=None)
```

ë•Œë•Œë¡œ Django ì¿¼ë¦¬ êµ¬ë¬¸ ë§Œìœ¼ë¡œëŠ” ë³µì¡í•œ `WHERE`ì ˆì„ ì‰½ê²Œ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤. ì´ëŸ¬í•œ ìƒí™©ì„ ìœ„í•´ DjangoëŠ” `extra()QuerySet`í•œì • ìë¥¼ ì œê³µí•œë‹¤. ì´ê²ƒì€ `QuerySet`ì— ì˜í•´ ìƒì„±ëœ SQLì— íŠ¹ì • ì ˆì„ ì‚½ì…í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤.

> **ğŸ’¡ì´ ë°©ë²•ì€ ìµœí›„ì˜ ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©í•  ê²ƒ**
 >
 >`extra()`ëŠ” í–¥í›„ Djangoì—ì„œ ì§€ì›ì„ ì¤‘ë‹¨í•˜ë ¤ëŠ” ì˜¤ë˜ëœ APIì´ë‹¤. ë‹¤ë¥¸ ì¿¼ë¦¬ì…‹ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥í•œë‹¤. DjangoëŠ” ë” ì´ìƒ `extra()`ì— ëŒ€í•œ ë²„ê·¸ë¥¼ ê°œì„ í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.
 >
 >```python
 >>>> qs.extra(
 >...     select={'val': "select col from sometable where othercol = %s"},
 >...     select_params=(someparam,),
 >... )
 >```
 >
 >ì´ê²ƒì€ `RawSQL`ì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ìŒê³¼ ë™ì¼í•˜ë‹¤.
 >
 >```python
 >>>> qs.annotate(val=RawSQL("select col from sometable where othercol = %s", (someparam,)))
 >```
 >
 >`RawSQL`ì‚¬ìš©ì‹œ ì£¼ìš” ì´ì ì€ í•„ìš”í•œ ê²½ìš° `output_field`ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì£¼ëœ ë‹¨ì ì€ raw SQLì—ì„œ ì¿¼ë¦¬ì…‹ì˜ ì¼ë¶€ í…Œì´ë¸” ë³„ì¹­ì„ ì°¸ì¡°í•˜ë©´ Djangoê°€ í•´ë‹¹ ë³„ì¹­ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. (ì˜ˆ: ì¿¼ë¦¬ì…‹ì´ ë˜ ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œ ì„œë¸Œì¿¼ë¦¬ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°)

> **âš ï¸ SQL injectionì— ì·¨ì•½í•œ `extra()`**
 >
 >`extra()`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” SQL injectionê³µê²©ì— ë§¤ìš° ì·¨ì•½í•˜ë¯€ë¡œ ì‚¬ìš©ìê°€ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œì–´í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•œë‹¤.
 >
 >ë˜í•œ SQLë¬¸ìì—´ì—ì„œ ìë¦¬ í‘œì‹œìë¥¼ ì¸ìš©í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤. ì´ ì˜ˆì œëŠ” `%s`ì£¼ìœ„ì˜ `''`ì‚¬ìš©ìœ¼ë¡œ ì´í•´ SQL injectionì— ì·¨ì•½í•˜ë‹¤.
 >
 >```python
 >SELECT col FROM sometable WHERE othercol = '%s'  # unsafe!
 >```
 >
 >Djangoì˜ SQL injection ë³´í˜¸ ì‘ë™ ë°©ì‹ì— ëŒ€í•´ì„  [ì—¬ê¸°](https://docs.djangoproject.com/en/3.1/topics/security/#sql-injection-protection)ë¥¼ ì°¸ê³  í•˜ë„ë¡ í•˜ì.

# defer( )

```python
defer(*fields)
```

ì¼ë¶€ ë³µì¡í•œ ë°ì´í„° ëª¨ë¸ë§ì—ì„œëŠ” ëª¨ë¸ì— ë§ì€ í•„ë“œê°€ í¬í•¨ë˜ë©°, ê·¸ì¤‘ ì¼ë¶€ì—ëŠ” ë§ì€ ë°ì´í„°(ex. `TextField`)ê°€ í¬í•¨ë  ìˆ˜ ìˆê±°ë‚˜ Python ê°ì²´ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ ë¬´ê±°ìš´ ì²˜ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆë‹¤. ë°ì´í„°ë¥¼ ì²˜ìŒ ê°€ì ¸ì˜¬ ë•Œ íŠ¹ì • í•„ë“œê°€ í•„ìš”í•œì§€ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ì—†ëŠ” ìƒí™©ì—ì„œ ì¿¼ë¦¬ì…‹ì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° Djangoì— ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²€ìƒ‰í•˜ì§€ ì•Šë„ë¡ ì§€ì‹œ í•  ìˆ˜ ìˆë‹¤.

ì´ëŠ” ë¡œë“œ ë˜ì§€ ì•Šë„ë¡ í•„ë“œì´ë¦„ì„  `defer()`ì— ì „ë‹¬í•˜ì—¬ ìˆ˜í–‰ëœë‹¤.

```python
# bodyì™€ headlineí•„ë“œë¥¼ ëª¨ë‘ ê²€ìƒ‰ì—ì„œ ì œì™¸ ì‹œí‚¨ë‹¤.
Entry.objects.defer("body").filter(rating=5).defer("headline")
```

ì§€ì—°ëœ ì§‘í•©ì— í•„ë“œê°€ ì¶”ê°€ë˜ëŠ” ìˆœì„œëŠ” ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. ì´ë¯¸ ê²€ìƒ‰í•˜ì§€ ì•Šë„ë¡ ì œê±°ëœ í•„ë“œ ì´ë¦„ìœ¼ë¡œ `defer()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ í•´ê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. (í•„ë“œëŠ” ì—¬ì „ì´ ê²€ìƒ‰ì—ì„œ ì œì™¸ë˜ì–´ ìˆë‹¤.)

double underscore (`__`)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ í•„ë“œë¥¼ êµ¬ë¶„í•˜ì—¬ ê´€ë ¨ëœ ëª¨ë¸ì˜ í•„ë“œë¥¼ ê²€ìƒ‰ì—ì„œ ì œì™¸ì‹œí‚¬ ìˆ˜ ìˆë‹¤.(`select_related`ë¥¼ í†µí•´ ì¿¼ë¦¬ì…‹ì„ ê°€ì ¸ì˜¬ ê²½ìš°)

```python
Blog.objects.select_related().defer("entry__headline", "entry__body")
```

ê²€ìƒ‰ì—ì„œ ì œì™¸ëœ í•„ë“œ ì§‘í•©ì„ í•´ì œí•˜ë ¤ë©´ `defer()`ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ `None`ì„ ì „ë‹¬í•œë‹¤.

```python
# ëª¨ë“  í•„ë“œë¥¼ ê°€ì ¸ì˜¨ë‹¤.
my_queryset.defer(None)
```

ëª¨ë¸ì˜ ì¼ë¶€ í•„ë“œëŠ” ê²€ìƒ‰ì—ì„œ ì œì™¸ë˜ì§€ ì•ŠëŠ”ë‹¤. íŠ¹íˆ Primary KeyëŠ” ê²€ìƒ‰ì—ì„œ ì œì™¸ ì‹œí‚¬ ìˆ˜ ì—†ë‹¤. `select_related()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ëª¨ë¸ì„ ê²€ìƒ‰í•˜ëŠ” ê²½ìš° ê¸°ë³¸ ëª¨ë¸ì—ì„œ ê´€ë ¨ëª¨ë¸ë¡œ ì—°ê²°ë˜ëŠ” í•„ë“œë¥¼ ê²€ìƒ‰ì—ì„œ ì œì™¸ì‹œí‚¤ë©´ ì•ˆëœë‹¤. ë§Œì•½ ê²€ìƒ‰ì—ì„œ ì œì™¸ëœë‹¤ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ê²€ìƒ‰ì—ì„œ ì œì™¸ëœ í•„ë“œê°€ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ `save()`ë¥¼ í˜¸ì¶œí•˜ë©´ ê²€ìƒ‰ëœ í•„ë“œë§Œ ì €ì¥ëœë‹¤.

# only( )

```python
only(*fields)
```

`only()`ë©”ì„œë“œëŠ” `defer()`ì™€ ë°˜ëŒ€ë˜ëŠ” ê°œë…ì´ë‹¤. ëª¨ë¸ì„ ê²€ìƒ‰í•  ë•Œ ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ì•¼ í•˜ëŠ” í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œí•œë‹¤. ê±°ì˜ ëª¨ë“  í•„ë“œë¥¼ ê²€ìƒ‰ì—ì„œ ì œì™¸í•´ì•¼ í•˜ëŠ” ëª¨ë¸ì´ ìˆëŠ” ê²½ìš° `only()`ë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œê°€ ë” ê°„ê²°í•´ ì§ˆ ìˆ˜ ìˆë‹¤.

ì´ë¦„, ë‚˜ì´, ìƒì• ì „ê¸°ê°€ ìˆëŠ” ëª¨ë¸ì´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ë‹¤ìŒ ë‘ ê°œì˜ ì¿¼ë¦¬ì…‹ì€ ê²€ìƒ‰ë˜ëŠ” í•„ë“œì˜ ì œí•œì— ìˆì–´ì„œ ë™ì¼í•˜ë‹¤.

```python
Person.objects.defer("age", "biography")
Person.objects.only("name")
```

`only()`ë¥¼ í˜¸ì¶œ í•  ë•Œë§ˆë‹¤ ì¦‰ì‹œ ë¡œë“œí•  í•„ë“œ ì„¸íŠ¸ë¥¼ ëŒ€ì²´ í•œë‹¤. ë©”ì„œë“œ ì´ë¦„ì€ `mnemonic`ì´ë‹¤. í•´ë‹¹ í•„ë“œ ë§Œ ì¦‰ì‹œ ë¡œë“œë˜ë©° ë‚˜ë¨¸ì§€ëŠ” ê²€ìƒ‰ì—ì„œ ì œì™¸ëœë‹¤. ë”°ë¼ì„œ `only()`ë¥¼ ì—°ì†ì ìœ¼ë¡œ í˜¸ì¶œí•˜ë©´ ë§ˆì§€ë§‰ í•„ë“œë§Œ ê³ ë ¤ëœë‹¤.

```python
# ìµœì¢… ê²°ê³¼ëŠ” `headline`ì„ ì œì™¸í•œ ëª¨ë“  ê²ƒì´ ê²€ìƒ‰ì—ì„œ ì œì™¸ ëœë‹¤.
Entry.objects.only("headline", "body").defer("body")

# ìµœì¢… ê²°ê³¼ëŠ” `headline`ê³¼ `body`ë¥¼ ì¦‰ì‹œ ë¡œë“œí•œë‹¤. (only()ëŠ” ê¸°ì¡´ í•„ë“œ ì„¸íŠ¸ë¥¼ ëŒ€ì²´í•œë‹¤.)
Entry.objects.defer("body").only("headline", "body")
```

`defer()`ì˜ ëª¨ë“  ì£¼ì˜ ì‚¬í•­ì€ `only()`ì—ë„ ì ìš©ëœë‹¤. ë‹¤ë¥¸ ì˜µì…˜ì„ ë‹¤ ì‚¬ìš©í•œ í›„ì—ë§Œ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.`only()`ë¥¼ ì‚¬ìš©í•˜ê³  `select_related()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ëœ í•„ë“œë¥¼ ìƒëµí•˜ëŠ” ê²ƒë„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ê²€ìƒ‰ì—ì„œ ì œì™¸ëœ í•„ë“œê°€ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ `save()`ë¥¼ í˜¸ì¶œí•˜ë©´ ê²€ìƒ‰ëœ í•„ë“œë§Œ ì €ì¥ëœë‹¤.

# using( )

```python
using(alias)
```

ì´ ë©”ì†Œë“œëŠ” ë‘˜ ì´ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì¿¼ë¦¬ì…‹ì´ í‰ê°€ ë  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. ì´ ë©”ì†Œë“œì˜ ë§¤ê°œë³€ìˆ˜ëŠ” `DATABASES`ì— ì •ì˜ëœ ë°ì´í„°ë² ì´ìŠ¤ ë³„ëª…ì´ë‹¤.

```python
# 'default'ë¼ê³  ì§€ì •ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.
>>> Entry.objects.all()

# 'backup'ë¼ê³  ì§€ì •ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.
>>> Entry.objects.using('backup')
```

# select\_for\_update( )

```python
select_for_update(nowait=False, skip_locked=False, of=())
```

íŠ¸ëœì­ì…˜ì´ ëë‚  ë•Œê¹Œì§€ í–‰ì— ë½ì„ ê±¸ê³  ì§€ì›ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ `SELECT ... FOR UPDATE` SQLë¬¸ì„ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ì…‹ì„ ë°˜í™˜í•œë‹¤.

```python
from django.db import transaction

entries = Entry.objects.select_for_update().filter(author=request.user)
with transaction.atomic():
    for entry in entries:
        ...
```

ì¿¼ë¦¬ì…‹ì„ í‰ê°€ ë  ë•Œ (ì´ ê²½ìš° í•­ëª©ì˜ í•­ëª©ì— ëŒ€í•´) ì¼ì¹˜í•˜ëŠ” ëª¨ë“  í•­ëª©ì€ íŠ¸ëœì­ì…˜ ë¸”ë¡ì´ ëë‚  ë•Œê¹Œì§€ ë½ì´ ê±¸ë¦°ë‹¤. ì¦‰, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ í•­ëª©ì— ëŒ€í•œ ë½ì„ ë³€ê²½í•˜ê±°ë‚˜ íšë“í•˜ì§€ ëª»í•˜ë„ë¡ í•œë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì„ íƒí•œ í–‰ ì¤‘ì— í•˜ë‚˜ì— ëŒ€í•´ ì´ë¯¸ ë½ì´ ê±¸ë¦° ê²½ìš° ë½ì´ í•´ì œë  ë•Œ ê¹Œì§€ ì¿¼ë¦¬ê°€ ì°¨ë‹¨ëœë‹¤. ì´ê²ƒì´ ì›í•˜ëŠ” ë™ì‘ì´ ì•„ë‹Œ ê²½ìš° `select_for_update(nowait = True)`ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë ‡ê²Œí•˜ë©´ í˜¸ì¶œì´ ì°¨ë‹¨ë˜ì§€ ì•ŠëŠ”ë‹¤ ì¶©ëŒí•˜ëŠ” ë½ì´ ì´ë¯¸ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì— ì˜í•´ íšë“ ëœ ê²½ìš° ì¿¼ë¦¬ì…‹ì´ í‰ê°€ ë  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. ëŒ€ì‹  `select_for_update(skip_locked = True)`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë½ì´ ê±¸ë¦° í–‰ì„ ë¬´ì‹œí•  ìˆ˜ë„ ìˆë‹¤. `nowait`ê³¼ `skip_locked`ëŠ” ìƒí˜¸ ë°°íƒ€ì ì´ë©° ë‘ ì˜µì…˜ì„ ëª¨ë‘ í™œì„±í™” í•œ ìƒíƒœì—ì„œ `select_for_update()`ë¥¼ í˜¸ì¶œí•˜ë©´ `ValueError`ê°€ ë°œìƒí•œë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ `select_for_update()`ëŠ” ì¿¼ë¦¬ì—ì„œ ì„ íƒí•œ ëª¨ë“  í–‰ì— ë½ì„ ê±´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `select_related()`ì— ì§€ì •ëœ ê´€ë ¨ ê°ì²´ì˜ í–‰ì€ ì¿¼ë¦¬ ì…‹ ëª¨ë¸ì˜ í–‰ê³¼ í•¨ê»˜ ì ê¸´ë‹¤. ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° `select_related()`ì™€ ë™ì¼í•œ í•„ë“œ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ `select_for_update(of = (...))`ë¥¼ í†µí•´ ë½ì„ ê±¸ë ¤ëŠ” ê´€ë ¨ ê°ì²´ë¥¼ ì§€ì •í•œë‹¤. ê²€ìƒ‰ì–´ ì„¸íŠ¸ì˜ ëª¨ë¸ì„ ì°¸ì¡°í•˜ë ¤ë©´ `self`ë¥¼ ì‚¬ìš©í•œë‹¤.

> **ğŸ’¡`select_for_update(of=(...))`ì—ì„œ ìƒìœ„ ëª¨ë¸ ë½ ê±¸ê¸°**
 >
 >ë‹¤ì¤‘ í…Œì´ë¸” ìƒì†ì„ ì‚¬ìš©í•  ë•Œ ìƒìœ„ ëª¨ë¸ì— ë½ì„ ê±¸ë ¤ë©´ `of`ì¸ìˆ˜ì— ìƒìœ„ ë§í¬ í•„ë“œ (ê¸°ë³¸ì ìœ¼ë¡œ `<parent_model_name>_ptr`)ë¥¼ ì§€ì •í•´ì•¼ í•œë‹¤. ì˜ˆë¥¼ ë“¤ë©´
 >
 >```python
 >Restaurant.objects.select_for_update(of=('self', 'place_ptr'))
 >```

`nullable`ê´€ê³„ì—ëŠ” `select_for_update()`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

```python
>>> Person.objects.select_related('hometown').select_for_update()

Traceback (most recent call last):
...
django.db.utils.NotSupportedError: FOR UPDATE cannot be applied to the nullable side of an outer join
```

ì´ëŸ¬í•œ ì œí•œì„ íšŒí”¼í•˜ê¸° ìœ„í•´ `null`ì´ í•„ìš” ì—†ëŠ” ê²½ìš° `null`ê°ì²´ë¥¼ ì œì™¸ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```python
>>> Person.objects.select_related('hometown').select_for_update().exclude(hometown=None)
<QuerySet [<Person: ...)>, ...]>
```

í˜„ì¬ PostgreSQL, Oracle, MySQLë°ì´í„°ë² ì´ìŠ¤ëŠ” `select_for_update()`ë¥¼ ì§€ì›í•œë‹¤. ê·¸ëŸ¬ë‚˜ MariaDB 10.3+ëŠ” `nowait`ë§Œ ì§€ì›ë˜ë©° MySQL 8.0.1+ëŠ” `nowait`ë° `skip_locked`ë¥¼ ì§€ì›í•œë‹¤. MySQLê³¼ MariaDBëŠ” `of`ì¸ìˆ˜ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

MySQLê³¼ ê°™ì´ ì´ëŸ¬í•œ ì˜µì…˜ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ `nowait=True, skip_locked = True`ë˜ëŠ” `select_for_update(of=(...))`ë¥¼ ì „ë‹¬í•˜ë©´ `NotSupportedError`ê°€ ë°œìƒí•œë‹¤.

`SELECT ... FOR UPDATE`ë¥¼ ì§€ì›í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ìë™ ì»¤ë°‹ ëª¨ë“œì—ì„œ `select_for_update()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ì„¸íŠ¸ë¥¼ í‰ê°€í•˜ëŠ” ê²ƒì€ ì´ ê²½ìš° í–‰ì— ë½ì´ ê±¸ë¦¬ì§€ ì•Šê¸° ë•Œë¬¸ì— `TransactionManagementError`ê°€ ë°œìƒí•œë‹¤. ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ í—ˆìš©í•œë‹¤ë©´ íŠ¸ëœì­ì…˜ì™¸ë¶€ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ì‹¤í–‰ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ì½”ë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„° ì†ìƒì´ ì‰½ê²Œ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

`SELECT ... FOR UPDATE`ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë² ì´ìŠ¤ (ex. SQLite)ì—ì„œ `select_for_update()`ë¥¼ ì‚¬ìš©í•˜ë©´ íš¨ê³¼ê°€ ì—†ë‹¤. `SELECT ... FOR UPDATE`ëŠ” ì¿¼ë¦¬ì— ì¶”ê°€ë˜ì§€ ì•Šìœ¼ë©° ìë™ ì»¤ë°‹ ëª¨ë“œì—ì„œ `select_for_update()`ë¥¼ ì‚¬ìš©í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

> **âš ï¸ TestCaseì—ì„œ `select_for_update()`ì‚¬ìš©ì‹œ ì£¼ì˜ ì‚¬í•­**
 >
 >`select_for_update()`ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìë™ ì»¤ë°‹ ëª¨ë“œì—ì„œ ì‹¤íŒ¨í•˜ì§€ë§Œ TestCaseëŠ” íŠ¸ëœì­ì…˜ì˜ ê° í…ŒìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ë˜í•‘í•˜ë¯€ë¡œ `atomic()`ë¸”ë¡ ì™¸ë¶€ì—ì„œë„ TestCaseì—ì„œ `select_for_update()`ë¥¼ í˜¸ì¶œí•˜ë©´ `TransactionManagementError`ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šê³  (ì•„ë§ˆë„ ì˜ˆê¸°ì¹˜ ì•Šê²Œ) í†µê³¼ëœë‹¤.`select_for_update()`ë¥¼ ì œëŒ€ë¡œ í…ŒìŠ¤íŠ¸ í•˜ë ¤ë©´ `TransactionTestCase`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

> **ğŸ’¡ì§€ì›ë˜ì§€ ì•ŠëŠ” í‘œí˜„ : Window function**
>
`select_for_update()`PostgreSQLì˜ Window function expressionì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

# raw( )

```python
raw(raw_query, params=None, translations=None)
```

raw SQL ì¿¼ë¦¬ë¥¼ ë°›ì•„ì„œ ì‹¤í–‰í•˜ê³  `django.db.models.query.RawQuerySet`ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. ì´ `RawQuerySet`ì¸ìŠ¤í„´ìŠ¤ëŠ” ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì¼ë°˜ `QuerySet`ì²˜ëŸ¼ ë°˜ë³µ ë  ìˆ˜ ìˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://docs.djangoproject.com/en/3.1/topics/db/sql/)ë¥¼ ì°¸ì¡°í•œë‹¤.

> **âš ï¸ `raw()`ì‚¬ìš©ì‹œ ì£¼ì˜ ì‚¬í•­**
>
`raw()`ëŠ” í•­ìƒ ìƒˆ ì¿¼ë¦¬ë¥¼ íŠ¸ë¦¬ê±°í•˜ê³  ì´ì „ í•„í„°ë§ì„ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì¼ë°˜ì ìœ¼ë¡œ Manager ë˜ëŠ” ìƒˆë¡œìš´ ì¿¼ë¦¬ì…‹ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ í˜¸ì¶œí•´ì•¼ í•œë‹¤.
